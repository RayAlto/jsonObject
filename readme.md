# JsonObject

JsonObject is a C++ json solution for practice which provide a python-like operation method, after my simple test, json in correct format according to [json.org](https://www.json.org/json-en.html) can be read correctly. But so far there is no error handling or method to modify the json.

---

## 1. Usage

At my current level, I have done my best to design the methods like python.

---

### 1.1. Construct a JsonObject

For example, a json is like

```json
{
    "widget": {
        "debug": "on",
        "window": {
            "title": "Sample Konfabulator Widget",
            "name": "main_window",
            "width": 500,
            "height": 500
        },
        "image": {
            "src": "Images/Sun.png",
            "name": "sun1",
            "hOffset": 250,
            "vOffset": 250,
            "alignment": "center"
        },
        "text": {
            "data": "Click Here",
            "size": 36,
            "style": "bold",
            "name": "text1",
            "hOffset": 250,
            "vOffset": 100,
            "alignment": "center",
            "onMouseUp": "sun1.opacity = (sun1.opacity / 100) * 90;"
        }
    }
}
```

You can use a normal constructor like:

```c++
JsonObject json (R"+*+*(
{
    "widget": {
        "debug": "on",
        "window": {
            "title": "Sample Konfabulator Widget",
            "name": "main_window",
            "width": 500,
            "height": 500
        },
        "image": {
            "src": "Images/Sun.png",
            "name": "sun1",
            "hOffset": 250,
            "vOffset": 250,
            "alignment": "center"
        },
        "text": {
            "data": "Click Here",
            "size": 36,
            "style": "bold",
            "name": "text1",
            "hOffset": 250,
            "vOffset": 100,
            "alignment": "center",
            "onMouseUp": "sun1.opacity = (sun1.opacity / 100) * 90;"
        }
    }
}
)+*+*");
```

There is a string literal `_json` for json, you can use it like:

```c++
auto json = R"+*+*(
{
    "widget": {
        "debug": "on",
        "window": {
            "title": "Sample Konfabulator Widget",
            "name": "main_window",
            "width": 500,
            "height": 500
        },
        "image": {
            "src": "Images/Sun.png",
            "name": "sun1",
            "hOffset": 250,
            "vOffset": 250,
            "alignment": "center"
        },
        "text": {
            "data": "Click Here",
            "size": 36,
            "style": "bold",
            "name": "text1",
            "hOffset": 250,
            "vOffset": 100,
            "alignment": "center",
            "onMouseUp": "sun1.opacity = (sun1.opacity / 100) * 90;"
        }
    }
}
)+*+*"_json;
```

Of course there is also a `load()` / `loads()` like python:

```c++
// read from a string
auto json = JsonObject::loads(R"+*+*(
{
    "widget": {
        "debug": "on",
        "window": {
            "title": "Sample Konfabulator Widget",
            "name": "main_window",
            "width": 500,
            "height":https://www.json.org/json-en.htmlmages/Sun.png",
            "name": "sun1",
            "hOffset": 250,
            "vOffset": 250,
            "alignment": "center"
        },
        "text": {
            "data": "Click Here",
            "size": 36,
            "style": "bold",
            "name": "text1",
            "hOffset": 250,
            "vOffset": 100,
            "alignment": "center",
            "onMouseUp": "sun1.opacity = (sun1.opacity / 100) * 90;"
        }
    }
}
)+*+*");

//read from a file
auto json = JsonObject::load("config/user.json");
```

---

### 1.2. Modify json

Modify methods is currently very limited, currently you cannot generate a json object by exact value, so you can only modify the json object generated by a string, and the object you want to modify cannot be a list or dict.

Before you modify a object you should make sure you know exactly about its type or you can figure it out by `type()`, return type is `enum class JsonObject::ObjType`.

You can modify an object by `operator=` which is the most "python-like" part of this repository.

```c++
auto json = JsonObject::load("config/user.json");

// ...

json["widget"]["text"]["data"] = "Don NOT Click Here";
json["widget"]["text"]["size"] = 48;
```

You can also use `getXXX()` to get the reference of the exact value of an object which is sensitive to type.

```c++
auto json = JsonObject::load("config/user.json");

// ...

json["widget"]["text"]["data"].getString() = "Don NOT Click Here";
json["widget"]["text"]["size"].getInt() = 48;
```

> Attension: The core part is a union of variety kinds of pointers, so assigning a value of a wrong type to an object may cause heap corruption, make sure you know exactly what you are doing!

---

### 1.3. Get a copy of the exact value of an object

If you do not need a reference to the exact value, you can use `toXXX` to get a copy of the exact value of an object, which may be a safer way to get the value of an object. If you are attempting to get the exact value of wrong type of the object, the function will return a meaningless value of your wrong type, which may be one of these: `0`, `false`, `""`.

```c++
auto json = JsonObject::load("config/user.json");

// ...

std::string widgetTextData = json["widget"]["text"]["data"].toString();
int widgetTextSize = json["widget"]["text"]["size"].toInt();
```

> Attension: there is currently no way to get a reference/copy to a list/dict!

---

### 1.5. Output a JsonObject

There is `dump()`/`dumps()` like Python, you can use it like:

```c++
auto json = JsonObject::load("config/user.json");

// ... Some modify?

// To file
JsonObject::dump("config/user.json", json, 4, false);

// As a string
std::string jsonString = JsonObject::dumps(json, 4, false);
```

#### Ensure Ascii

Same as Python, the fourth parameter of `dump()` and the third parameter fo `dumps()` can be set to ensure that the output characters are all ASCII character

If `ensureAscii` is set to true, All Unicode character will be output as `\uXXXX`

> Attension: `toString()` can only be used in string type objects to get a copy of its string!

---

### 1.4. Some operations related to dict/list/string

There is currently some operations related to dict/list/string, which corresponds to stl container.

1. `clear()`: mapped to `clear()` for `std::list`/`std::string`, if you use `clear()` for other types of objects like `int`, the object will be assigned a meaningless value which may be one of these:  `0`, `false`, `""`.
1. `empty()`: mapped to `empty()` for `std::list`/`std::string`, if you use `empty()` for other types of objects like `int`, the return value is always `false`.
1. `size()`: mapped to `size()` for `std::list`/`std::string`, if you use `size()` for other types of objects like `int`, the return value is always `0`.

---

## 2. Controversial parts

There is still some disputes about how this work.

---

### 2.1. Unicode character

[Json.org](https://www.json.org/json-en.html) shows that json only supports Unicode character which is in the form of `\uXXXX`, so emoji is not suitable for json according to the website.

In this repository, Unicode character is handled in compliance with the website regulations.